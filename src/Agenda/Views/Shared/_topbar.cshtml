@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

@{
    var email = User.Identity?.Name;
}

<input type="hidden" class="email" value="@User.Identity?.Name" />

<header id="page-topbar">
    <div class="navbar-header">
        <div class="d-flex">
            <div class="navbar-brand-box">
                <a href="" class="logo logo-dark">
                    <span class="logo-sm">
                        <img src="~/images/winsigaLogo.png" alt="" height="40">
                    </span>
                    <span class="logo-lg">
                        <img src="~/images/logo.png" alt="" height="40">
                    </span>
                </a>

                <a href="" class="logo logo-light">
                    <span class="logo-sm">
                        <img src="~/images/logo-white.png" alt="" height="25">
                    </span>
                    <span class="logo-lg">
                        <img src="~/images/logo-white.png" alt="" height="25">
                    </span>
                </a>
            </div>

            <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect" id="vertical-menu-btn">
                <i class="fa fa-fw fa-bars"></i>
            </button>
        </div>

        <div class="d-flex">
            <div class="d-flex" style="position:relative;">
                <div style="display:flex;align-self:center;">
                    @* <a asp-action="Index" asp-controller="Chat" asp-area="Chats"><i style="font-size:24px; color:grey; cursor:pointer;" class='bx bx-message-rounded-dots'></i></a> *@
                    <i id="silenciar-som" style="display:none;position:absolute;font-size:24px;right:-5px;bottom:15px; color:darkred; cursor:pointer;" class='bx bxs-volume-mute'></i>
                    <span id="badge-chats-abertos" style="display:none;position:absolute;top:2px;right:-5px;background-color:#dc3545;color:white;border-radius:50%;width:18px;height:18px;font-size:10px;font-weight:bold;text-align:center;line-height:18px;">0</span>
                </div>

                @* <audio id="som_notificacao" style="display:none;">
                    <source src="~/audio/novo_chat_alerta.mp3" type="audio/mpeg">
                </audio>
                <audio id="som_nova_msg" style="display:none;">
                    <source src="~/audio/msg_chat_alerta.mp3" type="audio/mpeg">
                </audio> *@
            </div>

            <div class="dropdown d-inline-block">
                <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    @* <img class="rounded-circle header-profile-user" src="~/assets/images/users/user-dummy-img.jpg" alt="Header Avatar"> *@
                    @* <span style="font-size:15px;" class="nome d-none d-xl-inline-block ms-1" key="t-henry">@email</span> *@
                    @* <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i> *@
                    <i class="bx bx-user font-size-24 align-middle"></i>
                </button>

                <div class="dropdown-menu dropdown-menu-end">
                    <a class="dropdown-item" href="#"><i class="bx bx-user font-size-16 align-middle me-1"></i> <span key="t-profile">Perfil</span></a>

                    @* @if (admin) { ... } *@
                    @* <dark-mode-switch></dark-mode-switch> *@

                    <div class="dropdown-divider"></div>

                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <a href="javascript:void(0);" class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#logoutModal">
                            <i class="bx bx-power-off font-size-16 align-middle me-1 text-danger"></i>
                            <span key="t-logout">Sair</span>
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>
</header>

<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background-color: #222736; color: #fff; border: 1px solid #32394e;">

            <div class="modal-header" style="border-bottom: 1px solid #32394e;">
                <h5 class="modal-title text-white" id="logoutModalLabel">
                    <i class="bx bx-log-out-circle me-2"></i>Log Out?
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body text-center p-4">
                <div class="mb-3">
                    <i class="bx bx-error-circle display-4 text-warning"></i>
                </div>
                <p class="mb-0 font-size-16">Certeza que gostaria de sair?</p>
                <p class="text-muted">Aperte "Sim" para deslogar ou "Não" para continuar.</p>
            </div>

            <div class="modal-footer justify-content-center" style="border-top: 1px solid #32394e;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>

                <form action="/Acessos/Logout" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-success">
                        Sim, sair <i class="bx bx-log-out ms-1"></i>
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>